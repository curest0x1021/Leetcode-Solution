<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta http-equiv="X-UA-Compatible" content="ie=edge"/><title>Design Movie Rental System - LeetCode javascript solutions</title><link rel="shortcut icon" href="https://curest0x1021.github.io/Leetcode-Solution/static/img/favicon.png" type="image/png"/><link rel="stylesheet" href="https://curest0x1021.github.io/Leetcode-Solution/static/css/app.css"/></head><body><header><h1>1912. Design Movie Rental System</h1><div class="row"><div class="name">Difficulty:</div><div class="value"><a href="https://curest0x1021.github.io/Leetcode-Solution/difficulty/hard" class="tag">Hard</a></div></div><div class="row"><div class="name">Related Topics:</div><div class="value"><ul class="clearfix"><li><a href="https://curest0x1021.github.io/Leetcode-Solution/tag/array">Array</a></li><li><a href="https://curest0x1021.github.io/Leetcode-Solution/tag/hash-table">Hash Table</a></li><li><a href="https://curest0x1021.github.io/Leetcode-Solution/tag/design">Design</a></li><li><a href="https://curest0x1021.github.io/Leetcode-Solution/tag/heap-priority-queue">Heap (Priority Queue)</a></li><li><a href="https://curest0x1021.github.io/Leetcode-Solution/tag/ordered-set">Ordered Set</a></li></ul></div></div><div class="row"><div class="name">Similar Questions:</div><div class="value"><ul class="clearfix"></ul></div></div></header><main><article class="markdown-body"><h2 id="problem">Problem</h2>
<p>You have a movie renting company consisting of <code>n</code> shops. You want to implement a renting system that supports searching for, booking, and returning movies. The system should also support generating a report of the currently rented movies.</p>
<p>Each movie is given as a 2D integer array <code>entries</code> where <code>entries[i] = [shopi, moviei, pricei]</code> indicates that there is a copy of movie <code>moviei</code> at shop <code>shopi</code> with a rental price of <code>pricei</code>. Each shop carries <strong>at most one</strong> copy of a movie <code>moviei</code>.</p>
<p>The system should support the following functions:</p>
<ul>
<li><p><strong>Search</strong>: Finds the <strong>cheapest 5 shops</strong> that have an <strong>unrented copy</strong> of a given movie. The shops should be sorted by <strong>price</strong> in ascending order, and in case of a tie, the one with the **smaller **<code>shopi</code> should appear first. If there are less than 5 matching shops, then all of them should be returned. If no shop has an unrented copy, then an empty list should be returned.</p></li>
<li><p><strong>Rent</strong>: Rents an <strong>unrented copy</strong> of a given movie from a given shop.</p></li>
<li><p><strong>Drop</strong>: Drops off a <strong>previously rented copy</strong> of a given movie at a given shop.</p></li>
<li><p><strong>Report</strong>: Returns the <strong>cheapest 5 rented movies</strong> (possibly of the same movie ID) as a 2D list <code>res</code> where <code>res[j] = [shopj, moviej]</code> describes that the <code>jth</code> cheapest rented movie <code>moviej</code> was rented from the shop <code>shopj</code>. The movies in <code>res</code> should be sorted by **price **in ascending order, and in case of a tie, the one with the **smaller **<code>shopj</code> should appear first, and if there is still tie, the one with the **smaller **<code>moviej</code> should appear first. If there are fewer than 5 rented movies, then all of them should be returned. If no movies are currently being rented, then an empty list should be returned.</p></li>
</ul>
<p>Implement the <code>MovieRentingSystem</code> class:</p>
<ul>
<li><p><code>MovieRentingSystem(int n, int[][] entries)</code> Initializes the <code>MovieRentingSystem</code> object with <code>n</code> shops and the movies in <code>entries</code>.</p></li>
<li><p><code>List&lt;Integer&gt; search(int movie)</code> Returns a list of shops that have an <strong>unrented copy</strong> of the given <code>movie</code> as described above.</p></li>
<li><p><code>void rent(int shop, int movie)</code> Rents the given <code>movie</code> from the given <code>shop</code>.</p></li>
<li><p><code>void drop(int shop, int movie)</code> Drops off a previously rented <code>movie</code> at the given <code>shop</code>.</p></li>
<li><p><code>List&lt;List&lt;Integer&gt;&gt; report()</code> Returns a list of cheapest <strong>rented</strong> movies as described above.</p></li>
</ul>
<p><strong>Note:</strong> The test cases will be generated such that <code>rent</code> will only be called if the shop has an <strong>unrented</strong> copy of the movie, and <code>drop</code> will only be called if the shop had <strong>previously rented</strong> out the movie.</p>
<p>&nbsp;
<strong>Example 1:</strong></p>
<pre><code class="hljs">Input
[<span class="hljs-string">"MovieRentingSystem"</span>, <span class="hljs-string">"search"</span>, <span class="hljs-string">"rent"</span>, <span class="hljs-string">"rent"</span>, <span class="hljs-string">"report"</span>, <span class="hljs-string">"drop"</span>, <span class="hljs-string">"search"</span>]
[[<span class="hljs-number">3</span>, [[<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">6</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">3</span>, <span class="hljs-number">7</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">7</span>], [<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>]]], [<span class="hljs-number">1</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>], [], [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">2</span>]]
Output
[<span class="hljs-literal">null</span>, [<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>], <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, [[<span class="hljs-number">0</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>]], <span class="hljs-literal">null</span>, [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>]]

Explanation
MovieRentingSystem movieRentingSystem = new MovieRentingSystem(<span class="hljs-number">3</span>, [[<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">6</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">3</span>, <span class="hljs-number">7</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">7</span>], [<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>]]);
movieRentingSystem.search(<span class="hljs-number">1</span>);  <span class="hljs-comment">// return [1, 0, 2], Movies of ID 1 are unrented at shops 1, 0, and 2. Shop 1 is cheapest; shop 0 and 2 are the same price, so order by shop number.</span>
movieRentingSystem.rent(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>); <span class="hljs-comment">// Rent movie 1 from shop 0. Unrented movies at shop 0 are now [2,3].</span>
movieRentingSystem.rent(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>); <span class="hljs-comment">// Rent movie 2 from shop 1. Unrented movies at shop 1 are now [1].</span>
movieRentingSystem.report();   <span class="hljs-comment">// return [[0, 1], [1, 2]]. Movie 1 from shop 0 is cheapest, followed by movie 2 from shop 1.</span>
movieRentingSystem.drop(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>); <span class="hljs-comment">// Drop off movie 2 at shop 1. Unrented movies at shop 1 are now [1,2].</span>
movieRentingSystem.search(<span class="hljs-number">2</span>);  <span class="hljs-comment">// return [0, 1]. Movies of ID 2 are unrented at shops 0 and 1. Shop 0 is cheapest, followed by shop 1.</span>
</code></pre>
<p>&nbsp;
<strong>Constraints:</strong></p>
<ul>
<li><p><code>1 &lt;= n &lt;= 3 * 105</code></p></li>
<li><p><code>1 &lt;= entries.length &lt;= 105</code></p></li>
<li><p><code>0 &lt;= shopi &lt; n</code></p></li>
<li><p><code>1 &lt;= moviei, pricei &lt;= 104</code></p></li>
<li><p>Each shop carries <strong>at most one</strong> copy of a movie <code>moviei</code>.</p></li>
<li><p>At most <code>105</code> calls <strong>in total</strong> will be made to <code>search</code>, <code>rent</code>, <code>drop</code> and <code>report</code>.</p></li>
</ul>
<h2 id="solution">Solution</h2>
<pre><code class="hljs lang-java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MovieRentingSystem</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Point</span> </span>{
        <span class="hljs-keyword">int</span> movie;
        <span class="hljs-keyword">int</span> shop;
        <span class="hljs-keyword">int</span> price;

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Point</span><span class="hljs-params">(<span class="hljs-keyword">int</span> movie, <span class="hljs-keyword">int</span> shop, <span class="hljs-keyword">int</span> price)</span> </span>{
            <span class="hljs-keyword">this</span>.movie = movie;
            <span class="hljs-keyword">this</span>.shop = shop;
            <span class="hljs-keyword">this</span>.price = price;
        }
    }

    <span class="hljs-keyword">private</span> HashMap&lt;Integer, TreeSet&lt;Point&gt;&gt; unrentedMovies = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();
    <span class="hljs-keyword">private</span> HashMap&lt;String, Integer&gt; shopMovieToPrice = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();
    <span class="hljs-keyword">private</span> Comparator&lt;Point&gt; comparator =
            (o1, o2) -&gt; {
                <span class="hljs-keyword">if</span> (o1.price != o2.price) {
                    <span class="hljs-keyword">return</span> Integer.compare(o1.price, o2.price);
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (o1.shop != o2.shop) {
                    <span class="hljs-keyword">return</span> Integer.compare(o1.shop, o2.shop);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">return</span> Integer.compare(o1.movie, o2.movie);
                }
            };
    <span class="hljs-keyword">private</span> TreeSet&lt;Point&gt; rented = <span class="hljs-keyword">new</span> TreeSet&lt;&gt;(comparator);

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MovieRentingSystem</span><span class="hljs-params">(<span class="hljs-keyword">int</span> n, <span class="hljs-keyword">int</span>[][] entries)</span> </span>{
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span>[] entry : entries) {
            <span class="hljs-keyword">int</span> shop = entry[<span class="hljs-number">0</span>];
            <span class="hljs-keyword">int</span> movie = entry[<span class="hljs-number">1</span>];
            <span class="hljs-keyword">int</span> price = entry[<span class="hljs-number">2</span>];
            unrentedMovies.putIfAbsent(movie, <span class="hljs-keyword">new</span> TreeSet&lt;&gt;(comparator));
            unrentedMovies.get(movie).add(<span class="hljs-keyword">new</span> Point(movie, shop, price));
            shopMovieToPrice.put(shop + <span class="hljs-string">"+"</span> + movie, price);
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Integer&gt; <span class="hljs-title">search</span><span class="hljs-params">(<span class="hljs-keyword">int</span> movie)</span> </span>{
        <span class="hljs-keyword">if</span> (!unrentedMovies.containsKey(movie)) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
        }
        Iterator&lt;Point&gt; iterator = unrentedMovies.get(movie).iterator();
        List&lt;Integer&gt; listOfShops = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
        <span class="hljs-keyword">while</span> (iterator.hasNext() &amp;&amp; listOfShops.size() &lt; <span class="hljs-number">5</span>) {
            listOfShops.add(iterator.next().shop);
        }
        <span class="hljs-keyword">return</span> listOfShops;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">rent</span><span class="hljs-params">(<span class="hljs-keyword">int</span> shop, <span class="hljs-keyword">int</span> movie)</span> </span>{
        <span class="hljs-keyword">int</span> price = shopMovieToPrice.get(shop + <span class="hljs-string">"+"</span> + movie);
        rented.add(<span class="hljs-keyword">new</span> Point(movie, shop, price));
        unrentedMovies.get(movie).remove(<span class="hljs-keyword">new</span> Point(movie, shop, price));
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">drop</span><span class="hljs-params">(<span class="hljs-keyword">int</span> shop, <span class="hljs-keyword">int</span> movie)</span> </span>{
        <span class="hljs-keyword">int</span> price = shopMovieToPrice.get(shop + <span class="hljs-string">"+"</span> + movie);
        rented.remove(<span class="hljs-keyword">new</span> Point(movie, shop, price));
        unrentedMovies.get(movie).add(<span class="hljs-keyword">new</span> Point(movie, shop, price));
    }

    <span class="hljs-keyword">public</span> List&lt;List&lt;Integer&gt;&gt; report() {
        List&lt;List&lt;Integer&gt;&gt; ans = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
        Iterator&lt;Point&gt; iterator = rented.iterator();
        <span class="hljs-keyword">while</span> (iterator.hasNext() &amp;&amp; ans.size() &lt; <span class="hljs-number">5</span>) {
            Point point = iterator.next();
            ans.add(Arrays.asList(point.shop, point.movie));
        }
        <span class="hljs-keyword">return</span> ans;
    }
}

<span class="hljs-comment">/**
 * Your MovieRentingSystem object will be instantiated and called as such:
 * MovieRentingSystem obj = new MovieRentingSystem(n, entries);
 * List&lt;Integer&gt; param_1 = obj.search(movie);
 * obj.rent(shop,movie);
 * obj.drop(shop,movie);
 * List&lt;List&lt;Integer&gt;&gt; param_4 = obj.report();
 */</span>
</code></pre>
<p><strong>Explain:</strong></p>
<p>nope.</p>
<p><strong>Complexity:</strong></p>
<ul>
<li>Time complexity : O(n).</li>
<li>Space complexity : O(n).</li>
</ul></article></main><footer><a href="https://github.com/curest0x1021/Leetcode-Solution" target="_blank"><img src="https://curest0x1021.github.io/Leetcode-Solution/static/img/github.png" alt="github"/></a></footer></body></html>