<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta http-equiv="X-UA-Compatible" content="ie=edge"/><title>Trips and Users - LeetCode javascript solutions</title><link rel="shortcut icon" href="https://curest0x1021.github.io/Leetcode-Solution/static/img/favicon.png" type="image/png"/><link rel="stylesheet" href="https://curest0x1021.github.io/Leetcode-Solution/static/css/app.css"/></head><body><header><h1>262. Trips and Users</h1><div class="row"><div class="name">Difficulty:</div><div class="value"><a href="https://curest0x1021.github.io/Leetcode-Solution/difficulty/hard" class="tag">Hard</a></div></div><div class="row"><div class="name">Related Topics:</div><div class="value"><ul class="clearfix"><li><a href="https://curest0x1021.github.io/Leetcode-Solution/tag/database">Database</a></li></ul></div></div><div class="row"><div class="name">Similar Questions:</div><div class="value"><ul class="clearfix"><li><a href="https://curest0x1021.github.io/Leetcode-Solution/problem/hopper-company-queries-i.html">Hopper Company Queries I</a></li><li><a href="https://curest0x1021.github.io/Leetcode-Solution/problem/hopper-company-queries-ii.html">Hopper Company Queries II</a></li><li><a href="https://curest0x1021.github.io/Leetcode-Solution/problem/hopper-company-queries-iii.html">Hopper Company Queries III</a></li></ul></div></div></header><main><article class="markdown-body"><h2 id="problem">Problem</h2>
<p>Table: <code>Trips</code></p>
<pre><code class="hljs">+-------------+----------+
| Column Name |<span class="hljs-built_in"> Type </span>    |
+-------------+----------+
| id          | int      |
| client_id   | int      |
| driver_id   | int      |
| city_id     | int      |
| status      | enum     |
| request_at  | date     |     
+-------------+----------+
id is the primary key <span class="hljs-keyword">for</span> this table.
The table holds all taxi trips. Each trip has a unique id, <span class="hljs-keyword">while</span> client_id <span class="hljs-keyword">and</span> driver_id are foreign keys <span class="hljs-keyword">to</span> the users_id at the<span class="hljs-built_in"> Users </span>table.
Status is an ENUM<span class="hljs-built_in"> type </span>of (<span class="hljs-string">'completed'</span>, <span class="hljs-string">'cancelled_by_driver'</span>, <span class="hljs-string">'cancelled_by_client'</span>).
</code></pre>
<p>&nbsp;</p>
<p>Table: <code>Users</code></p>
<pre><code class="hljs">+-------------+----------+
| Column Name |<span class="hljs-built_in"> Type </span>    |
+-------------+----------+
| users_id    | int      |
| banned      | enum     |
| role        | enum     |
+-------------+----------+
users_id is the primary key <span class="hljs-keyword">for</span> this table.
The table holds all users. Each<span class="hljs-built_in"> user </span>has a unique users_id, <span class="hljs-keyword">and</span> role is an ENUM<span class="hljs-built_in"> type </span>of (<span class="hljs-string">'client'</span>, <span class="hljs-string">'driver'</span>, <span class="hljs-string">'partner'</span>).
banned is an ENUM<span class="hljs-built_in"> type </span>of (<span class="hljs-string">'Yes'</span>, <span class="hljs-string">'No'</span>).
</code></pre>
<p>&nbsp;</p>
<p>The <strong>cancellation rate</strong> is computed by dividing the number of canceled (by client or driver) requests with unbanned users by the total number of requests with unbanned users on that day.</p>
<p>Write a SQL query to find the <strong>cancellation rate</strong> of requests with unbanned users (<strong>both client and driver must not be banned</strong>) each day between <code>"2013-10-01"</code> and <code>"2013-10-03"</code>. Round <code>Cancellation Rate</code> to <strong>two decimal</strong> points.</p>
<p>Return the result table in <strong>any order</strong>.</p>
<p>The query result format is in the following example.</p>
<p>&nbsp;
<strong>Example 1:</strong></p>
<pre><code class="hljs">Input: 
Trips table:
+----+-----------+-----------+---------+---------------------+------------+
| id | client_id | driver_id | city_id | status              | request_at |
+----+-----------+-----------+---------+---------------------+------------+
| <span class="hljs-number">1</span>  | <span class="hljs-number">1</span>         | <span class="hljs-number">10</span>        | <span class="hljs-number">1</span>       | completed           | <span class="hljs-number">2013</span><span class="hljs-number">-10</span><span class="hljs-number">-01</span> |
| <span class="hljs-number">2</span>  | <span class="hljs-number">2</span>         | <span class="hljs-number">11</span>        | <span class="hljs-number">1</span>       | cancelled_by_driver | <span class="hljs-number">2013</span><span class="hljs-number">-10</span><span class="hljs-number">-01</span> |
| <span class="hljs-number">3</span>  | <span class="hljs-number">3</span>         | <span class="hljs-number">12</span>        | <span class="hljs-number">6</span>       | completed           | <span class="hljs-number">2013</span><span class="hljs-number">-10</span><span class="hljs-number">-01</span> |
| <span class="hljs-number">4</span>  | <span class="hljs-number">4</span>         | <span class="hljs-number">13</span>        | <span class="hljs-number">6</span>       | cancelled_by_client | <span class="hljs-number">2013</span><span class="hljs-number">-10</span><span class="hljs-number">-01</span> |
| <span class="hljs-number">5</span>  | <span class="hljs-number">1</span>         | <span class="hljs-number">10</span>        | <span class="hljs-number">1</span>       | completed           | <span class="hljs-number">2013</span><span class="hljs-number">-10</span><span class="hljs-number">-02</span> |
| <span class="hljs-number">6</span>  | <span class="hljs-number">2</span>         | <span class="hljs-number">11</span>        | <span class="hljs-number">6</span>       | completed           | <span class="hljs-number">2013</span><span class="hljs-number">-10</span><span class="hljs-number">-02</span> |
| <span class="hljs-number">7</span>  | <span class="hljs-number">3</span>         | <span class="hljs-number">12</span>        | <span class="hljs-number">6</span>       | completed           | <span class="hljs-number">2013</span><span class="hljs-number">-10</span><span class="hljs-number">-02</span> |
| <span class="hljs-number">8</span>  | <span class="hljs-number">2</span>         | <span class="hljs-number">12</span>        | <span class="hljs-number">12</span>      | completed           | <span class="hljs-number">2013</span><span class="hljs-number">-10</span><span class="hljs-number">-03</span> |
| <span class="hljs-number">9</span>  | <span class="hljs-number">3</span>         | <span class="hljs-number">10</span>        | <span class="hljs-number">12</span>      | completed           | <span class="hljs-number">2013</span><span class="hljs-number">-10</span><span class="hljs-number">-03</span> |
| <span class="hljs-number">10</span> | <span class="hljs-number">4</span>         | <span class="hljs-number">13</span>        | <span class="hljs-number">12</span>      | cancelled_by_driver | <span class="hljs-number">2013</span><span class="hljs-number">-10</span><span class="hljs-number">-03</span> |
+----+-----------+-----------+---------+---------------------+------------+
Users table:
+----------+--------+--------+
| users_id | banned | role   |
+----------+--------+--------+
| <span class="hljs-number">1</span>        | No     | client |
| <span class="hljs-number">2</span>        | Yes    | client |
| <span class="hljs-number">3</span>        | No     | client |
| <span class="hljs-number">4</span>        | No     | client |
| <span class="hljs-number">10</span>       | No     | driver |
| <span class="hljs-number">11</span>       | No     | driver |
| <span class="hljs-number">12</span>       | No     | driver |
| <span class="hljs-number">13</span>       | No     | driver |
+----------+--------+--------+
Output: 
+------------+-------------------+
| Day        | Cancellation Rate |
+------------+-------------------+
| <span class="hljs-number">2013</span><span class="hljs-number">-10</span><span class="hljs-number">-01</span> | <span class="hljs-number">0.33</span>              |
| <span class="hljs-number">2013</span><span class="hljs-number">-10</span><span class="hljs-number">-02</span> | <span class="hljs-number">0.00</span>              |
| <span class="hljs-number">2013</span><span class="hljs-number">-10</span><span class="hljs-number">-03</span> | <span class="hljs-number">0.50</span>              |
+------------+-------------------+
Explanation: 
On <span class="hljs-number">2013</span><span class="hljs-number">-10</span><span class="hljs-number">-01</span>:
  - There were <span class="hljs-number">4</span> requests <span class="hljs-keyword">in</span> total, <span class="hljs-number">2</span> of which were canceled.
  - However, the request with Id=<span class="hljs-number">2</span> was made by a banned client (User_Id=<span class="hljs-number">2</span>), so it <span class="hljs-keyword">is</span> ignored <span class="hljs-keyword">in</span> the calculation.
  - Hence there are <span class="hljs-number">3</span> unbanned requests <span class="hljs-keyword">in</span> total, <span class="hljs-number">1</span> of which was canceled.
  - The Cancellation Rate <span class="hljs-keyword">is</span> (<span class="hljs-number">1</span> / <span class="hljs-number">3</span>) = <span class="hljs-number">0.33</span>
On <span class="hljs-number">2013</span><span class="hljs-number">-10</span><span class="hljs-number">-02</span>:
  - There were <span class="hljs-number">3</span> requests <span class="hljs-keyword">in</span> total, <span class="hljs-number">0</span> of which were canceled.
  - The request with Id=<span class="hljs-number">6</span> was made by a banned client, so it <span class="hljs-keyword">is</span> ignored.
  - Hence there are <span class="hljs-number">2</span> unbanned requests <span class="hljs-keyword">in</span> total, <span class="hljs-number">0</span> of which were canceled.
  - The Cancellation Rate <span class="hljs-keyword">is</span> (<span class="hljs-number">0</span> / <span class="hljs-number">2</span>) = <span class="hljs-number">0.00</span>
On <span class="hljs-number">2013</span><span class="hljs-number">-10</span><span class="hljs-number">-03</span>:
  - There were <span class="hljs-number">3</span> requests <span class="hljs-keyword">in</span> total, <span class="hljs-number">1</span> of which was canceled.
  - The request with Id=<span class="hljs-number">8</span> was made by a banned client, so it <span class="hljs-keyword">is</span> ignored.
  - Hence there are <span class="hljs-number">2</span> unbanned request <span class="hljs-keyword">in</span> total, <span class="hljs-number">1</span> of which were canceled.
  - The Cancellation Rate <span class="hljs-keyword">is</span> (<span class="hljs-number">1</span> / <span class="hljs-number">2</span>) = <span class="hljs-number">0.50</span>
</code></pre>
<h2 id="solution">Solution</h2>
<pre><code class="hljs lang-sql"><span class="hljs-keyword">select</span> t.Request_at <span class="hljs-keyword">as</span> <span class="hljs-keyword">Day</span>, <span class="hljs-keyword">round</span>(<span class="hljs-keyword">sum</span>(<span class="hljs-keyword">case</span> <span class="hljs-keyword">when</span> t.Status != <span class="hljs-string">'completed'</span> <span class="hljs-keyword">then</span> <span class="hljs-number">1</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span> <span class="hljs-keyword">end</span>)/<span class="hljs-keyword">count</span>(*),<span class="hljs-number">2</span>)
<span class="hljs-keyword">as</span> <span class="hljs-string">'Cancellation Rate'</span>
<span class="hljs-keyword">from</span> Trips t
<span class="hljs-keyword">where</span> t.Client_Id <span class="hljs-keyword">in</span> (<span class="hljs-keyword">select</span> Users_Id <span class="hljs-keyword">from</span> <span class="hljs-keyword">Users</span> <span class="hljs-keyword">where</span> Banned =<span class="hljs-string">'No'</span>)
<span class="hljs-keyword">and</span> t.Driver_Id <span class="hljs-keyword">in</span> (<span class="hljs-keyword">select</span> Users_Id <span class="hljs-keyword">from</span> <span class="hljs-keyword">Users</span> <span class="hljs-keyword">where</span> Banned = <span class="hljs-string">'No'</span>)
<span class="hljs-keyword">and</span> t.Request_at <span class="hljs-keyword">between</span> <span class="hljs-string">'2013-10-01'</span> <span class="hljs-keyword">and</span> <span class="hljs-string">'2013-10-03'</span>
<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> t.Request_at;
</code></pre>
<p><strong>Explain:</strong></p>
<p>nope.</p>
<p><strong>Complexity:</strong></p>
<ul>
<li>Time complexity : O(n).</li>
<li>Space complexity : O(n).</li>
</ul></article></main><footer><a href="https://github.com/curest0x1021/Leetcode-Solution" target="_blank"><img src="https://curest0x1021.github.io/Leetcode-Solution/static/img/github.png" alt="github"/></a></footer></body></html>