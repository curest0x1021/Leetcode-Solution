<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta http-equiv="X-UA-Compatible" content="ie=edge"/><title>Painting a Grid With Three Different Colors - LeetCode javascript solutions</title><link rel="shortcut icon" href="https://curest0x1021.github.io/Leetcode-Solution/static/img/favicon.png" type="image/png"/><link rel="stylesheet" href="https://curest0x1021.github.io/Leetcode-Solution/static/css/app.css"/></head><body><header><h1>1931. Painting a Grid With Three Different Colors</h1><div class="row"><div class="name">Difficulty:</div><div class="value"><a href="https://curest0x1021.github.io/Leetcode-Solution/difficulty/hard" class="tag">Hard</a></div></div><div class="row"><div class="name">Related Topics:</div><div class="value"><ul class="clearfix"><li><a href="https://curest0x1021.github.io/Leetcode-Solution/tag/dynamic-programming">Dynamic Programming</a></li></ul></div></div><div class="row"><div class="name">Similar Questions:</div><div class="value"><ul class="clearfix"><li><a href="https://curest0x1021.github.io/Leetcode-Solution/problem/number-of-ways-to-paint-n-3-grid.html">Number of Ways to Paint N Ã— 3 Grid</a></li></ul></div></div></header><main><article class="markdown-body"><h2 id="problem">Problem</h2>
<p>You are given two integers <code>m</code> and <code>n</code>. Consider an <code>m x n</code> grid where each cell is initially white. You can paint each cell <strong>red</strong>, <strong>green</strong>, or <strong>blue</strong>. All cells <strong>must</strong> be painted.</p>
<p>Return** the number of ways to color the grid with <strong>no two adjacent cells having the same color</strong>**. Since the answer can be very large, return it *<em>modulo</em>* <code>109 + 7</code>.</p>
<p>&nbsp;
<strong>Example 1:</strong></p>
<p><img src="https://assets.leetcode.com/uploads/2021/06/22/colorthegrid.png" alt="" /></p>
<pre><code class="hljs"><span class="hljs-attr">Input:</span> <span class="hljs-string">m</span> <span class="hljs-string">=</span> <span class="hljs-number">1</span><span class="hljs-string">,</span> <span class="hljs-string">n</span> <span class="hljs-string">=</span> <span class="hljs-number">1</span>
<span class="hljs-attr">Output:</span> <span class="hljs-number">3</span>
<span class="hljs-attr">Explanation:</span> <span class="hljs-string">The</span> <span class="hljs-string">three</span> <span class="hljs-string">possible</span> <span class="hljs-string">colorings</span> <span class="hljs-string">are</span> <span class="hljs-string">shown</span> <span class="hljs-string">in</span> <span class="hljs-string">the</span> <span class="hljs-string">image</span> <span class="hljs-string">above.</span>
</code></pre>
<p><strong>Example 2:</strong></p>
<p><img src="https://assets.leetcode.com/uploads/2021/06/22/copy-of-colorthegrid.png" alt="" /></p>
<pre><code class="hljs"><span class="hljs-attr">Input:</span> <span class="hljs-string">m</span> <span class="hljs-string">=</span> <span class="hljs-number">1</span><span class="hljs-string">,</span> <span class="hljs-string">n</span> <span class="hljs-string">=</span> <span class="hljs-number">2</span>
<span class="hljs-attr">Output:</span> <span class="hljs-number">6</span>
<span class="hljs-attr">Explanation:</span> <span class="hljs-string">The</span> <span class="hljs-string">six</span> <span class="hljs-string">possible</span> <span class="hljs-string">colorings</span> <span class="hljs-string">are</span> <span class="hljs-string">shown</span> <span class="hljs-string">in</span> <span class="hljs-string">the</span> <span class="hljs-string">image</span> <span class="hljs-string">above.</span>
</code></pre>
<p><strong>Example 3:</strong></p>
<pre><code class="hljs"><span class="hljs-attr">Input:</span> <span class="hljs-string">m</span> <span class="hljs-string">=</span> <span class="hljs-number">5</span><span class="hljs-string">,</span> <span class="hljs-string">n</span> <span class="hljs-string">=</span> <span class="hljs-number">5</span>
<span class="hljs-attr">Output:</span> <span class="hljs-number">580986</span>
</code></pre>
<p>&nbsp;
<strong>Constraints:</strong></p>
<ul>
<li><p><code>1 &lt;= m &lt;= 5</code></p></li>
<li><p><code>1 &lt;= n &lt;= 1000</code></p></li>
</ul>
<h2 id="solution">Solution</h2>
<pre><code class="hljs lang-java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Solution</span> </span>{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> P = <span class="hljs-number">1_000_000_007</span>;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">colorTheGrid</span><span class="hljs-params">(<span class="hljs-keyword">int</span> m, <span class="hljs-keyword">int</span> n)</span> </span>{
        <span class="hljs-keyword">if</span> (m == <span class="hljs-number">1</span>) {
            <span class="hljs-keyword">return</span> (<span class="hljs-keyword">int</span>) (<span class="hljs-number">3L</span> * powMod(<span class="hljs-number">2</span>, n - <span class="hljs-number">1</span>) % P);
        }
        <span class="hljs-keyword">if</span> (m == <span class="hljs-number">2</span>) {
            <span class="hljs-keyword">return</span> (<span class="hljs-keyword">int</span>) (<span class="hljs-number">6L</span> * powMod(<span class="hljs-number">3</span>, n - <span class="hljs-number">1</span>) % P);
        }
        <span class="hljs-keyword">if</span> (n == <span class="hljs-number">1</span>) {
            <span class="hljs-keyword">return</span> (<span class="hljs-keyword">int</span>) (<span class="hljs-number">3L</span> * powMod(<span class="hljs-number">2</span>, m - <span class="hljs-number">1</span>) % P);
        }
        <span class="hljs-keyword">if</span> (n == <span class="hljs-number">2</span>) {
            <span class="hljs-keyword">return</span> (<span class="hljs-keyword">int</span>) (<span class="hljs-number">6L</span> * powMod(<span class="hljs-number">3</span>, m - <span class="hljs-number">1</span>) % P);
        }
        <span class="hljs-keyword">int</span> totalTemplates = <span class="hljs-number">1</span> &lt;&lt; (m - <span class="hljs-number">2</span>);
        <span class="hljs-keyword">int</span> totalPaintings = binPow(<span class="hljs-number">3</span>, m);
        <span class="hljs-keyword">int</span>[] paintingToTemplate = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[totalPaintings];
        <span class="hljs-keyword">long</span>[] paintingCountForTemplate = <span class="hljs-keyword">new</span> <span class="hljs-keyword">long</span>[totalTemplates];
        <span class="hljs-keyword">long</span>[][] templateEdgeCount = <span class="hljs-keyword">new</span> <span class="hljs-keyword">long</span>[totalTemplates][totalTemplates];
        Map&lt;Integer, Integer&gt; templateToIndex = <span class="hljs-keyword">new</span> HashMap&lt;&gt;(<span class="hljs-number">1</span> &lt;&lt; (m - <span class="hljs-number">2</span>));
        <span class="hljs-keyword">int</span> templateCounter = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; totalPaintings; i++) {
            <span class="hljs-keyword">int</span> type = getType(i, m);
            <span class="hljs-keyword">if</span> (type == -<span class="hljs-number">1</span>) {
                paintingToTemplate[i] = -<span class="hljs-number">1</span>;
                <span class="hljs-keyword">continue</span>;
            }
            Integer templateIndex = templateToIndex.get(type);
            <span class="hljs-keyword">if</span> (templateIndex == <span class="hljs-keyword">null</span>) {
                templateToIndex.put(type, templateCounter);
                templateIndex = templateCounter++;
            }
            paintingToTemplate[i] = templateIndex;
            paintingCountForTemplate[templateIndex]++;
        }
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; totalPaintings; i++) {
            <span class="hljs-keyword">if</span> (paintingToTemplate[i] == -<span class="hljs-number">1</span>) {
                <span class="hljs-keyword">continue</span>;
            }
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = i + <span class="hljs-number">1</span>; j &lt; totalPaintings; j++) {
                <span class="hljs-keyword">if</span> (paintingToTemplate[j] == -<span class="hljs-number">1</span>) {
                    <span class="hljs-keyword">continue</span>;
                }
                <span class="hljs-keyword">if</span> (checkAllowance(i, j, m)) {
                    templateEdgeCount[paintingToTemplate[i]][paintingToTemplate[j]]++;
                    templateEdgeCount[paintingToTemplate[j]][paintingToTemplate[i]]++;
                }
            }
        }
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; totalTemplates; i++) {
            <span class="hljs-keyword">long</span> c = paintingCountForTemplate[i];
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; totalTemplates; j++) {
                templateEdgeCount[i][j] /= c;
            }
        }
        <span class="hljs-keyword">long</span>[][] matrixPower = matrixPower(templateEdgeCount, (<span class="hljs-keyword">long</span>) n - <span class="hljs-number">1</span>);
        <span class="hljs-keyword">long</span> ans = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; totalTemplates; i++) {
            <span class="hljs-keyword">long</span> s = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">long</span>[] arr = matrixPower[i];
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">long</span> a : arr) {
                s += a;
            }
            ans += paintingCountForTemplate[i] * s;
        }
        <span class="hljs-keyword">return</span> (<span class="hljs-keyword">int</span>) (ans % P);
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">checkAllowance</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a, <span class="hljs-keyword">int</span> b, <span class="hljs-keyword">int</span> m)</span> </span>{
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; m; i++) {
            <span class="hljs-keyword">if</span> (a % <span class="hljs-number">3</span> == b % <span class="hljs-number">3</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
            }
            a /= <span class="hljs-number">3</span>;
            b /= <span class="hljs-number">3</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getType</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a, <span class="hljs-keyword">int</span> m)</span> </span>{
        <span class="hljs-keyword">int</span>[] digits = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[<span class="hljs-number">3</span>];
        <span class="hljs-keyword">int</span> first = a % <span class="hljs-number">3</span>;
        <span class="hljs-keyword">int</span> second = a % <span class="hljs-number">9</span> / <span class="hljs-number">3</span>;
        <span class="hljs-keyword">if</span> (first == second) {
            <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
        }
        digits[second] = <span class="hljs-number">1</span>;
        digits[<span class="hljs-number">3</span> - first - second] = <span class="hljs-number">2</span>;
        <span class="hljs-keyword">int</span> prev = second;
        <span class="hljs-keyword">int</span> type = <span class="hljs-number">1</span>;
        m -= <span class="hljs-number">2</span>;
        a /= <span class="hljs-number">9</span>;
        <span class="hljs-keyword">while</span> (m-- &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">int</span> curr = a % <span class="hljs-number">3</span>;
            <span class="hljs-keyword">if</span> (prev == curr) {
                <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
            }
            type = type * <span class="hljs-number">3</span> + digits[curr];
            prev = curr;
            a /= <span class="hljs-number">3</span>;
        }
        <span class="hljs-keyword">return</span> type;
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">powMod</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a, <span class="hljs-keyword">int</span> b)</span> </span>{
        <span class="hljs-keyword">long</span> res = <span class="hljs-number">1</span>;
        <span class="hljs-keyword">while</span> (b != <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">if</span> ((b &amp; <span class="hljs-number">1</span>) != <span class="hljs-number">0</span>) {
                res = (res * a) % P;
                --b;
            } <span class="hljs-keyword">else</span> {
                a = (<span class="hljs-keyword">int</span>) (((<span class="hljs-keyword">long</span>) a * a) % P);
                b &gt;&gt;= <span class="hljs-number">1</span>;
            }
        }
        <span class="hljs-keyword">return</span> (<span class="hljs-keyword">int</span>) res;
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">binPow</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a, <span class="hljs-keyword">int</span> n)</span> </span>{
        <span class="hljs-keyword">int</span> res = <span class="hljs-number">1</span>;
        <span class="hljs-keyword">int</span> tmp = a;
        <span class="hljs-keyword">while</span> (n != <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">if</span> ((n &amp; <span class="hljs-number">1</span>) != <span class="hljs-number">0</span>) {
                res *= tmp;
            }
            tmp *= tmp;
            n &gt;&gt;= <span class="hljs-number">1</span>;
        }
        <span class="hljs-keyword">return</span> res;
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">long</span>[][] matrixPower(<span class="hljs-keyword">long</span>[][] base, <span class="hljs-keyword">long</span> pow) {
        <span class="hljs-keyword">int</span> n = base.length;
        <span class="hljs-keyword">long</span>[][] res = <span class="hljs-keyword">new</span> <span class="hljs-keyword">long</span>[n][n];
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++) {
            res[i][i] = <span class="hljs-number">1</span>;
        }
        <span class="hljs-keyword">while</span> (pow != <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">if</span> ((pow &amp; <span class="hljs-number">1</span>) != <span class="hljs-number">0</span>) {
                res = multiplyMatrix(res, base);
                --pow;
            } <span class="hljs-keyword">else</span> {
                base = multiplyMatrix(base, base);
                pow &gt;&gt;= <span class="hljs-number">1</span>;
            }
        }
        <span class="hljs-keyword">return</span> res;
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">long</span>[][] multiplyMatrix(<span class="hljs-keyword">long</span>[][] a, <span class="hljs-keyword">long</span>[][] b) {
        <span class="hljs-keyword">int</span> n = a.length;
        <span class="hljs-keyword">long</span>[][] ans = <span class="hljs-keyword">new</span> <span class="hljs-keyword">long</span>[n][n];
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++) {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; n; j++) {
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> k = <span class="hljs-number">0</span>; k &lt; n; k++) {
                    ans[i][j] += a[i][k] * b[k][j];
                }
                ans[i][j] %= P;
            }
        }
        <span class="hljs-keyword">return</span> ans;
    }
}
</code></pre>
<p><strong>Explain:</strong></p>
<p>nope.</p>
<p><strong>Complexity:</strong></p>
<ul>
<li>Time complexity : O(n).</li>
<li>Space complexity : O(n).</li>
</ul></article></main><footer><a href="https://github.com/curest0x1021/Leetcode-Solution" target="_blank"><img src="https://curest0x1021.github.io/Leetcode-Solution/static/img/github.png" alt="github"/></a></footer></body></html>